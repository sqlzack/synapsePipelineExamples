{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workspaceName": {
            "type": "string",
            "metadata": "Workspace name"
        }
    },
    "variables": { "workspaceId": "[concat('Microsoft.Synapse/workspaces/', parameters('workspaceName'))]" },
    "resources": [
        {
            "name": "[concat(parameters('workspaceName'), '/pl_pauseScaleResume')]",
            "type": "Microsoft.Synapse/workspaces/pipelines",
            "apiVersion": "2019-06-01-preview",
            "properties": {
                "activities": [
                    {
                        "name": "Perform Action",
                        "type": "Switch",
                        "dependsOn": [
                            {
                                "activity": "Check for SQLPool",
                                "dependencyConditions": [ "Succeeded" ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "on": {
                                "value": "@toLower(pipeline().parameters.Action)",
                                "type": "Expression"
                            },
                            "cases": [
                                {
                                    "value": "pause",
                                    "activities": [
                                        {
                                            "name": "pause",
                                            "type": "WebActivity",
                                            "dependsOn": [],
                                            "policy": {
                                                "timeout": "7.00:00:00",
                                                "retry": 0,
                                                "retryIntervalInSeconds": 30,
                                                "secureOutput": false,
                                                "secureInput": false
                                            },
                                            "userProperties": [],
                                            "typeProperties": {
                                                "url": {
                                                    "value": "@concat('https://management.azure.com/subscriptions/',pipeline().parameters.SubscriptionId,'/resourceGroups/',pipeline().parameters.ResourceGroup,'/providers/Microsoft.Synapse/workspaces/',pipeline().parameters.SynapseWorkspace,'/sqlPools/',pipeline().parameters.SqlPool,'/',toLower(pipeline().parameters.Action),'?api-version=2021-06-01')",
                                                    "type": "Expression"
                                                },
                                                "connectVia": {
                                                    "referenceName": "AutoResolveIntegrationRuntime",
                                                    "type": "IntegrationRuntimeReference"
                                                },
                                                "method": "POST",
                                                "headers": {},
                                                "body": {},
                                                "authentication": {
                                                    "type": "MSI",
                                                    "resource": "https://management.azure.com"
                                                }
                                            }
                                        }
                                    ]
                                },
                                {
                                    "value": "resume",
                                    "activities": [
                                        {
                                            "name": "resume",
                                            "type": "WebActivity",
                                            "dependsOn": [],
                                            "policy": {
                                                "timeout": "7.00:00:00",
                                                "retry": 0,
                                                "retryIntervalInSeconds": 30,
                                                "secureOutput": false,
                                                "secureInput": false
                                            },
                                            "userProperties": [],
                                            "typeProperties": {
                                                "url": {
                                                    "value": "@concat('https://management.azure.com/subscriptions/',pipeline().parameters.SubscriptionId,'/resourceGroups/',pipeline().parameters.ResourceGroup,'/providers/Microsoft.Synapse/workspaces/',pipeline().parameters.SynapseWorkspace,'/sqlPools/',pipeline().parameters.SqlPool,'/',toLower(pipeline().parameters.Action),'?api-version=2021-06-01')",
                                                    "type": "Expression"
                                                },
                                                "connectVia": {
                                                    "referenceName": "AutoResolveIntegrationRuntime",
                                                    "type": "IntegrationRuntimeReference"
                                                },
                                                "method": "POST",
                                                "headers": {},
                                                "body": {},
                                                "authentication": {
                                                    "type": "MSI",
                                                    "resource": "https://management.azure.com"
                                                }
                                            }
                                        }
                                    ]
                                },
                                {
                                    "value": "scale",
                                    "activities": [
                                        {
                                            "name": "scale",
                                            "type": "WebActivity",
                                            "dependsOn": [],
                                            "policy": {
                                                "timeout": "7.00:00:00",
                                                "retry": 0,
                                                "retryIntervalInSeconds": 30,
                                                "secureOutput": false,
                                                "secureInput": false
                                            },
                                            "userProperties": [],
                                            "typeProperties": {
                                                "url": {
                                                    "value": "@concat('https://management.azure.com/subscriptions/',pipeline().parameters.SubscriptionId,'/resourceGroups/',pipeline().parameters.ResourceGroup,'/providers/Microsoft.Synapse/workspaces/',pipeline().parameters.SynapseWorkspace,'/sqlPools/',pipeline().parameters.SqlPool,'?api-version=2021-06-01')",
                                                    "type": "Expression"
                                                },
                                                "connectVia": {
                                                    "referenceName": "AutoResolveIntegrationRuntime",
                                                    "type": "IntegrationRuntimeReference"
                                                },
                                                "method": "PUT",
                                                "headers": {},
                                                "body": {
                                                    "value": "@concat('{\"location\":\"',pipeline().parameters.Region,'\",\"sku\":{\"name\":\"',toUpper(pipeline().parameters.ActionScale),'\"}}')",
                                                    "type": "Expression"
                                                },
                                                "authentication": {
                                                    "type": "MSI",
                                                    "resource": "https://management.azure.com"
                                                }
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                    },
                    {
                        "name": "Check for SQLPool",
                        "type": "WebActivity",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "url": {
                                "value": "@concat('https://management.azure.com/subscriptions/',pipeline().parameters.SubscriptionId,'/resourceGroups/',pipeline().parameters.ResourceGroup,'/providers/Microsoft.Synapse/workspaces/',pipeline().parameters.SynapseWorkspace,'/sqlPools/',pipeline().parameters.SqlPool,'?api-version=2021-06-01')",
                                "type": "Expression"
                            },
                            "connectVia": {
                                "referenceName": "AutoResolveIntegrationRuntime",
                                "type": "IntegrationRuntimeReference"
                            },
                            "method": "GET",
                            "headers": {},
                            "authentication": {
                                "type": "MSI",
                                "resource": "https://management.azure.com"
                            }
                        }
                    }
                ],
                "policy": {
                    "elapsedTimeMetric": {},
                    "cancelAfter": {}
                },
                "parameters": {
                    "Action": {
                        "type": "string",
                        "defaultValue": ""
                    },
                    "ActionScale": { "type": "string" },
                    "SubscriptionId": {
                        "type": "string",
                        "defaultValue": ""
                    },
                    "ResourceGroup": {
                        "type": "string",
                        "defaultValue": ""
                    },
                    "SynapseWorkspace": {
                        "type": "string",
                        "defaultValue": ""
                    },
                    "SqlPool": {
                        "type": "string",
                        "defaultValue": ""
                    },
                    "Region": {
                        "type": "string",
                        "defaultValue": ""
                    }
                },
                "folder": { "name": "pauseScaleResume" },
                "annotations": []
            },
            "dependsOn": []
        }
    ]
}